<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Stored XSS Realistic Demo</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f0f2f5; padding:2rem; }
    .container { max-width: 700px; margin:auto; background:#fff; padding:2rem; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
    h1 { margin-bottom:1rem; }
    textarea { width:100%; height:80px; padding:0.5rem; border:1px solid #aaa; border-radius:4px; }
    button { margin-top:0.5rem; padding:0.5rem 1rem; cursor:pointer; }
    #commentsBox { margin-top:1.5rem; display:none; }
    .comment { border-bottom:1px solid #ddd; padding:0.75rem 0; }
    #status { margin-top:1rem; padding:0.75rem; border-radius:6px; display:none; }
    .success { background:#e6ffed; border:1px solid #2ecc71; color:#2d7a43; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Article Page</h1>
    <p>This is a demo blog article. Students can post comments below. If someone posts a malicious script, it will be stored and executed whenever users view the comments.</p>

    <h2>Leave a Comment</h2>
    <textarea id="commentInput" placeholder="Write your comment..."></textarea><br>
    <button id="postBtn">Post Comment</button>
    <button id="viewBtn">View Comments</button>
    <button id="clearBtn">Clear Comments</button>

    <!-- status message -->
    <div id="status"></div>

    <div id="commentsBox">
      <h2>Comments</h2>
      <div id="comments"></div>
    </div>
  </div>

  <script>
    // Save comment into localStorage
    document.getElementById("postBtn").addEventListener("click", function() {
      const input = document.getElementById("commentInput");
      const comments = JSON.parse(localStorage.getItem("comments") || "[]");
      comments.push(input.value);  // store raw HTML payload
      localStorage.setItem("comments", JSON.stringify(comments));
      input.value = "";

      // Show success message (not popup)
      const statusDiv = document.getElementById("status");
      statusDiv.textContent = "‚úÖ Comment posted! Click 'View Comments' to load all comments.";
      statusDiv.className = "success";
      statusDiv.style.display = "block";
    });

    // Load and display comments (payload executes here)
    document.getElementById("viewBtn").addEventListener("click", function() {
      const commentsDiv = document.getElementById("comments");
      const commentsBox = document.getElementById("commentsBox");
      commentsBox.style.display = "block";
      commentsDiv.innerHTML = "";

      const comments = JSON.parse(localStorage.getItem("comments") || "[]");
      comments.forEach(c => {
        const div = document.createElement("div");
        div.className = "comment";

        // ‚ùå Vulnerable: directly injecting stored user input
        div.innerHTML = c;

        commentsDiv.appendChild(div);
      });
    });

    // Clear all saved comments
    document.getElementById("clearBtn").addEventListener("click", function() {
      localStorage.removeItem("comments");  // wipe from storage
      document.getElementById("comments").innerHTML = "";  // clear UI
      document.getElementById("commentsBox").style.display = "none"; // hide box
      const statusDiv = document.getElementById("status");
      statusDiv.textContent = "üóëÔ∏è All comments cleared.";
      statusDiv.className = "success";
      statusDiv.style.display = "block";
    });
  </script>
</body>
</html>
